<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orden Completa</title>

    <!-- Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        :root {
            --primary-color: #28a745;
            --secondary-color: #8bc34a;
            --background-gradient: linear-gradient(140deg, var(--secondary-color), var(--primary-color));
            --text-color: #2d3436;
            --accent-color: #20c997;
            --font-family: 'Lato', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-image: var(--background-gradient);
            font-family: var(--font-family);
        }

        .container {
            background-color: #fff;
            border-radius: 30px;
            box-shadow: 0 0 20px 10px rgba(38, 38, 69, 0.52);
            width: 90%;
            max-width: 1200px;
            padding: 2rem;
            overflow: hidden;
        }

        h2 {
            text-align: center;
            color: var(--text-color);
            margin-bottom: 1rem;
            font-size: 2rem;
            letter-spacing: 3px;
        }

        table {
            width: 100%;
            margin-top: 1rem;
            border-collapse: collapse;
        }

        td, th {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: var(--primary-color);
            color: white;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            outline: none;
            font-size: 1rem;
        }

        .button-group {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 2rem;
        }

        button {
            background: linear-gradient(0deg, rgba(86, 180, 109, 1) 0%, rgba(61, 143, 87, 1) 100%);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            background: var(--accent-color);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        .section-header {
            background: var(--primary-color);
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
            margin-top: 2rem;
        }

        .error {
            color: red;
            font-weight: bold;
        }

        .success {
            color: green;
            font-weight: bold;
        }

        @media screen and (max-width: 768px) {
            table {
                font-size: 0.9rem;
            }

            input, select, textarea {
                font-size: 0.9rem;
            }

            button {
                font-size: 0.9rem;
            }
        }
        .label {
            font-weight: bold;
        }
        .payment-label {
            font-weight: bold;
        }
        .header {
            font-weight: bold;
        }

    </style>
</head>
<body>
    <div class="container">
        
        <h2 style="text-align: center;">ORDEN DE PEDIDO</h2>       
        <form action="/submit" method="post" onsubmit="return validarPagos()">
            <table>
                <tr>
                    <td class="label">Fecha:</td>
                    <td colspan="2">
                        <input type="text" id="fecha" class="form-control" name="fecha" required />
                    </td>
                    <td class="order-number" colspan="2" style="text-align: left;">
                        <span style="color: red; font-size: 1.5rem; font-weight: bold;">N° {{ numero_orden }}</span>
                    </td>
                </tr>
                <tr>
                    <td class="label">Nombre del Laboratorio:</td>
                    <td colspan="4"><input type="text" name="nombre_laboratorio" required></td>
                </tr>
                <tr>
                    <td class="label">Vendedor:</td>
                    <td colspan="4"><input type="text" name="vendedor" required></td>
                </tr>
                <tr>
                    <td class="label">Nombre del Cliente:</td>
                    <td colspan="4"><input type="text" name="nombre_cliente" required></td>
                </tr>
                <tr>
                    <td class="label">Tipo de Identificación:</td>
                    <td>
                        <select name="tipo_identificacion" required>
                            <option value="Registro Civil">Registro Civil</option>
                            <option value="Tarjeta de Identidad">Tarjeta de Identidad</option>
                            <option value="Cédula Ciudadanía">Cédula Ciudadanía</option>
                            <option value="Tarjeta Extranjería">Tarjeta Extranjería</option>
                            <option value="Cédula Extranjería">Cédula Extranjería</option>
                            <option value="NIT">NIT</option>
                            <option value="Pasaporte">Pasaporte</option>
                            <option value="Documento Identidad Extranjero">Documento Identidad Extranjero</option>
                            <option value="NUIP">NUIP</option>
                            <option value="PEP">PEP</option>
                            <option value="Salvoconducto de Permanencia">Salvoconducto de Permanencia</option>
                            <option value="PPT">PPT</option>
                        </select>
                    </td>
                    <td class="label">Número de Identificación:</td>
                    <td colspan="2">
                        <input type="text" name="numero_identificacion" required>
                    </td>
                </tr>
                <tr>
                    <td class="label">Departamento:</td>
                    <td>
                        <select id="departamento" name="departamento" required>
                            <option value="">Selecciona un Departamento</option>
                        </select>
                    </td>
                    <td class="label">Ciudad:</td>
                    <td colspan="2">
                        <select id="ciudad" name= "ciudad" required>
                            <option value="">Selecciona una Ciudad</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td class="label">Barrio:</td>
                    <td><input type="text" name="barrio" required></td>
                    <td class="label">Dirección de entrega:</td>
                    <td colspan="2"><input type="text" name="direccion_entrega" required></td>
                </tr>
                <tr>
                    <td class="label">Teléfonos:</td>
                    <td><input type="text" name="telefonos" required></td>
                    <td class="label">Email:</td>
                    <td colspan="2"><input type="text" name="email" required></td>
                </tr>
                <tr>
                    <td class="label">Tipo Régimen IVA:</td>
                    <td colspan="4">
                        <select name="tipo_regimen_iva" required>
                            <option value="Persona Natural">Persona Natural</option>
                            <option value="Persona Jurídica">Persona Jurídica</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td class="label">Código Montura:</td>
                    <td><input type="text" name="codigo_montura" required></td>
                    <td class="label">Valor Montura:</td>
                    <td colspan="2">
                        <input type="text" name="valor_montura_hidden" required oninput="formatCurrency(this, 'valor_montura')">
                        <input type="hidden" name="valor_montura" id="valor_montura">
                    </td>
                </tr>
                <tr>
                    <td class="label">Código Lente:</td>
                    <td><input type="text" name="codigo_lente"></td>
                    <td class="label">Valor Lente:</td>
                    <td colspan="2">
                        <input type="text" name="valor_lente_hidden" oninput="formatCurrency(this, 'valor_lente')">
                        <input type="hidden" name="valor_lente" id="valor_lente">
                    </td>
                </tr>
                <tr>
                    <td class="label">Otros:</td>
                    <td><input type="text" name="otros"></td>
                    <td class="label">Valor Otros:</td>
                    <td colspan="2">
                        <input type="text" name="valor_otros_hidden" oninput="formatCurrency(this, 'valor_otros')">
                        <input type="hidden" name="valor_otros" id="valor_otros">
                    </td>
                </tr>

                <tr>
                    <td class="label">Total Venta:</td>
                    <td colspan="4">
                        <input type="text" name="total_venta_hidden" id="total_venta_hidden" readonly>
                        <input type="hidden" name="total_venta" id="total_venta">
                    </td>
                </tr>

                <tr class="section-header">
                    <td colspan="5" class="section-header">FORMAS DE PAGO</td>
                </tr>
                <tr>
                    <td class="payment-label">Efectivo:</td>
                    <td>
                        <input type="text" name="pago_efectivo_hidden" oninput="formatCurrency(this, 'pago_efectivo')">
                        <input type="hidden" name="pago_efectivo" id="pago_efectivo">
                    </td>
                    <td class="payment-label">Sistecredito:</td>
                    <td colspan="2">
                        <input type="text" name="pago_sistecredito_hidden" oninput="formatCurrency(this, 'pago_sistecredito')">
                        <input type="hidden" name="pago_sistecredito" id="pago_sistecredito">
                    </td>
                </tr>
                <tr>
                    <td class="payment-label">Bancolombia:</td>
                    <td>
                        <input type="text" name="pago_bancolombia_hidden" oninput="formatCurrency(this, 'pago_bancolombia')">
                        <input type="hidden" name="pago_bancolombia" id="pago_bancolombia">
                    </td>
                    <td class="payment-label">Davivienda:</td>
                    <td colspan="2">
                        <input type="text" name="pago_davivienda_hidden" oninput="formatCurrency(this, 'pago_davivienda')">
                        <input type="hidden" name="pago_davivienda" id="pago_davivienda">
                    </td>
                </tr>
                <tr>
                    <td class="payment-label">Addi:</td>
                    <td>
                        <input type="text" name="pago_addi_hidden" oninput="formatCurrency(this, 'pago_addi')">
                        <input type="hidden" name="pago_addi" id="pago_addi">
                    </td>
                    <td class="payment-label">Envia:</td>
                    <td colspan="2">
                        <input type="text" name="pago_envia_hidden" oninput="formatCurrency(this, 'pago_envia')">
                        <input type="hidden" name="pago_envia" id="pago_envia">
                    </td>
                </tr>
                <tr>
                    <td class="payment-label">Inter Rapidismo:</td>
                    <td>
                        <input type="text" name="pago_interapidismo_hidden" oninput="formatCurrency(this, 'pago_interapidismo')">
                        <input type="hidden" name="pago_interapidismo" id="pago_interapidismo">
                    </td>
                    <td class="payment-label">Pasarela de Pagos:</td>
                    <td colspan="2">
                        <input type="text" name="pasa_pagos_hidden" oninput="formatCurrency(this, 'pasa_pagos')">
                        <input type="hidden" name="pasa_pagos" id="pasa_pagos">
                    </td>
                </tr>
                <tr>
                    <td class="payment-label">Bold:</td>
                    <td>
                        <input type="text" name="pago_bold_hidden" oninput="formatCurrency(this, 'pago_bold')">
                        <input type="hidden" name="pago_bold" id="pago_bold">
                    </td>
                    <td class="payment-label">Mensajería EKlat:</td>
                    <td colspan="2">
                        <input type="text" name="pago_mensajeria_eklat_hidden" oninput="formatCurrency(this, 'pago_mensajeria_eklat')">
                        <input type="hidden" name="pago_mensajeria_eklat" id="pago_mensajeria_eklat">
                    </td>
                </tr>
                <tr>
                    <td class="payment-label">Mercado Pago:</td>
                    <td>
                        <input type="text" name="pago_mercadopago_hidden" oninput="formatCurrency(this, 'pago_mercadopago')">
                        <input type="hidden" name="pago_mercadopago" id="pago_mercadopago">
                    </td>
                    <td class="payment-label">Servientrega:</td>
                    <td colspan="2">
                        <input type="text" name="pago_servientrega_hidden" oninput="formatCurrency(this, 'pago_servientrega')">
                        <input type="hidden" name="pago_servientrega" id="pago_servientrega">
                    </td>
                </tr>
                <tr>
                    <td class="payment-label">Otro:</td>
                    <td colspan="4">
                        <input type="text" name="pago_otro_hidden" oninput="formatCurrency(this, 'pago_otro')">
                        <input type="hidden" name="pago_otro" id="pago_otro">
                    </td>
                </tr>


                <tr>
                    <td class="label">Fecha de Entrega:</td>
                    <td colspan="4">
                        <input type="text" id="fecha_entrega" class="form-control" name="fecha_entrega" required />
                    </td>
                </tr>    
                <tr>
                    <td class="label" colspan="5">Observaciones:<textarea name="observaciones" rows="3"></textarea></td>
                </tr>
            </table>

            <h2 style="text-align: center;">ORDEN DE LABORATORIO</h2>
            <table>
                    <tr>
                        <td colspan="2" class="header">Fecha:</td>
                        <td colspan="3">
                            <input type="text" id="fecha_lab" name="fecha_lab" readonly/>
                        </td>
                        <td class="order-number" colspan="2" style="text-align: left;">
                            <span style="color: red; font-size: 1.5rem; font-weight: bold;">N° {{ numero_orden }}</span>
                        </td>
                    </tr>
                    <tr colspan="5">
                        <th></th>
                        <th>Esfera</th>
                        <th>Cilindro</th>
                        <th>Eje</th>
                        <th>Adición</th>
                        <th>DP</th>
                    </tr>
                    <tr>
                        <td class="header">O.D.</td>
                        <td><input type="text" name="esfera_od"></td>
                        <td><input type="text" name="cilindro_od"></td>
                        <td><input type="text" name="eje_od"></td>
                        <td><input type="text" name="adicion_od"></td>
                        <td><input type="text" name="dp_od"></td>
                    </tr>
                    <tr>
                        <td class="header">O.I.</td>
                        <td><input type="text" name="esfera_oi"></td>
                        <td><input type="text" name="cilindro_oi"></td>
                        <td><input type="text" name="eje_oi"></td>
                        <td><input type="text" name="adicion_oi"></td>
                        <td><input type="text" name="dp_oi"></td>
                    </tr>
                </table>

                <table>
                    <tr>
                        <td class="header">REF: Montura</td>
                        <td colspan="2"><input type="text" name="montura" required></td>
                        <td class="header">Color:</td>
                        <td colspan="2"><input type="text" name="color" required></td>
                    </tr>
                    <tr>
                        <td class="header">Material Lentes:</td>
                        <td colspan="2"><input type="text" name="material_lentes"></td>
                        <td class="header">AR:</td>
                        <td colspan="5">
                            <select name="ar" id="ar-select" required>
                                <option value="">Seleccione</option>
                                <option value="Blanco">Blanco</option>
                                <option value="Green">Green</option>
                                <option value="Blue">Blue Block</option>
                                <option value="Otro">Otro</option>
                            </select>
                
                            <!-- Campo de texto para "Otro" que se mostrará cuando se seleccione "Otro" -->
                            <input type="text" name="ar_otro" id="ar-otro-input" placeholder="Especifique otro" style="display: none; width: 50%; margin-left: 10px;">
                        </td>
                    </tr>
                    <tr>
                        <td class="header">Progresivo:</td>
                        <td colspan="2">
                            <select name="progresivo" id="progresivo-select" required>
                                <option value="">Seleccione</option>
                                <option value="SI">Sí</option>
                                <option value="NO">No</option>
                            </select>

                            <!-- Campo de selección adicional para la gama de Progresivo -->
                            <select name="progresivo_gama" id="progresivo-gama" style="display: none; margin-left: 10px;">
                                <option value="">Seleccione una gama</option>
                                <option value="Premium">Premium</option>
                                <option value="Alta">Alta</option>
                                <option value="Media">Media</option>
                            </select>
                        </td>
                        <td class="header">Monofocal:</td>
                        <td colspan="5">
                            <select name="monofocal" id="monofocal-select" required>
                                <option value="">Seleccione</option>
                                <option value="SI">Sí</option>
                                <option value="NO">No</option>
                            </select>

                            <!-- Campo de selección adicional para las opciones de Monofocal -->
                            <select name="monofocal_option" id="monofocal-options" style="display: none; margin-left: 10px;">
                                <option value="">Seleccione una opción</option>
                                <option value="Terminado">Terminado</option>
                                <option value="Extrarrango">Extrarrango</option>
                                <option value="Tallado">Tallado</option>
                            </select>
                        </td>
                    <tr>
                        <td class="header">Fotocromático:</td>
                        <td colspan="2">
                            <select name="fotocrom" id="fotocromatico-select" required>
                                <option value="">Seleccione</option>
                                <option value="SI">Sí</option>
                                <option value="NO">No</option>
                            </select>
            <!-- Campo de texto para "Cual" que solo aparecerá si seleccionan "Sí" -->
                            <input type="text" name="fotocromatico_cual" id="fotocromatico-cual-input" placeholder="Cual" style="display: none; width: 50%; margin-left: 10px;">
                        </td>
                        <td class="header">Bifocal:</td>
                        <td colspan="5">
                            <select name="bifocal" id="bifocal-select" required>
                                <option value="">Seleccione</option>
                                <option value="Invisible">Invisible</option>
                                <option value="Flat Top">Flat Top</option>
                                <option value="N/A">N/A</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td class="header">AF:</td>
                        <td colspan="2"><input type="text" name="af"></td>
                        <td class="header">Corredor:</td>
                        <td colspan="2"><input type="text" name="corredor"></td>
                    </tr>
                    <tr>
                        <td class="header">Adicional:</td>
                        <td colspan="5"><input type="text" name="adicional"></td>
                    </tr>
                </table>

                <table>
                    <tr>
                        <td class="header">Ordenado a:</td>
                        <td colspan="3"><input type="text" name="ordenado_a" id="ordenado_a" readonly></td>
                    </tr>
                    <tr>
                        <td class="header">Ordenado por:</td>
                        <td colspan="3"><input type="text" name="ordenado_por" id="ordenado_por" readonly></td>
                    </tr>                
                </table>
       
                <div class="button-group">
                    <button type="submit">Enviar Orden</button>
                    <button type="button" onclick="window.location.href='{{ url_for('menu') }}'">Volver al Menú</button>
                </div>   
        </form> 
    </div>
    <script>
        function calculateTotal() {
            const valorMontura = parseFloat(document.getElementById('valor_montura').value) || 0;
            const valorLente = parseFloat(document.getElementById('valor_lente').value) || 0;
            const otros = parseFloat(document.getElementById('valor_otros').value) || 0;
            const totalVenta = valorMontura + valorLente + otros;
            document.getElementById('total_venta_hidden').value = totalVenta.toLocaleString('es-CO', { style: 'currency', currency: 'COP', minimumFractionDigits: 0 });
            document.getElementById('total_venta').value = totalVenta; // Actualizar el campo oculto
        }

        document.querySelector('input[name="valor_montura_hidden"]').addEventListener('input', calculateTotal);
        document.querySelector('input[name="valor_lente_hidden"]').addEventListener('input', calculateTotal);
        document.querySelector('input[name="valor_otros_hidden"]').addEventListener('input', calculateTotal);
    </script>

    <script>
        function validateCylinderAndAxis() {
            // Obtener los valores de los campos de cilindro y eje para OD (Ojo Derecho)
            const cilindroOD = document.querySelector('input[name="cilindro_od"]').value;
            const ejeOD = document.querySelector('input[name="eje_od"]');
            
            // Si hay un valor en el campo de cilindro para OD, el campo de eje será obligatorio
            if (cilindroOD !== "") {
                ejeOD.required = true;
            } else {
                ejeOD.required = false;
            }
    
            // Obtener los valores de los campos de cilindro y eje para OI (Ojo Izquierdo)
            const cilindroOI = document.querySelector('input[name="cilindro_oi"]').value;
            const ejeOI = document.querySelector('input[name="eje_oi"]');
            
            // Si hay un valor en el campo de cilindro para OI, el campo de eje será obligatorio
            if (cilindroOI !== "") {
                ejeOI.required = true;
            } else {
                ejeOI.required = false;
            }
        }
    
        // Agregar eventos de escucha para detectar cuando se cambia el valor en los campos de cilindro
        document.querySelector('input[name="cilindro_od"]').addEventListener('input', validateCylinderAndAxis);
        document.querySelector('input[name="cilindro_oi"]').addEventListener('input', validateCylinderAndAxis);
    </script>
    <script>
        function validateAdditionAndDependentFields() {
            // Obtener los valores de los campos de Adición, DP y AF para OD (Ojo Derecho)
            const adicionOD = document.querySelector('input[name="adicion_od"]').value;
            const dpOD = document.querySelector('input[name="dp_od"]');
            const afOD = document.querySelector('input[name="af"]');
            
            // Si hay un valor en el campo de Adición para OD, los campos DP y AF serán obligatorios
            if (adicionOD !== "") {
                dpOD.required = true;
                afOD.required = true;
            } else {
                dpOD.required = false;
                afOD.required = false;
            }
    
            // Obtener los valores de los campos de Adición, DP y AF para OI (Ojo Izquierdo)
            const adicionOI = document.querySelector('input[name="adicion_oi"]').value;
            const dpOI = document.querySelector('input[name="dp_oi"]');
            
            // Si hay un valor en el campo de Adición para OI, el campo DP será obligatorio
            if (adicionOI !== "") {
                dpOI.required = true;
            } else {
                dpOI.required = false;
            }
        }
    
        // Agregar eventos de escucha para detectar cuando se cambia el valor en los campos de Adición
        document.querySelector('input[name="adicion_od"]').addEventListener('input', validateAdditionAndDependentFields);
        document.querySelector('input[name="adicion_oi"]').addEventListener('input', validateAdditionAndDependentFields);
    </script>
    <script>
        document.getElementById('ar-select').addEventListener('change', function() {
            const arOtroInput = document.getElementById('ar-otro-input');
            
            if (this.value === 'Otro') {
                arOtroInput.style.display = 'inline-block';
                arOtroInput.required = true;  // Hacer obligatorio el campo si selecciona "Otro"
            } else {
                arOtroInput.style.display = 'none';
                arOtroInput.required = false;  // Quitar la obligatoriedad si no es "Otro"
                arOtroInput.value = '';  // Limpiar el campo si se oculta
            }
        });
    </script>    
    <script>
        document.getElementById('fotocromatico-select').addEventListener('change', function() {
            const fotocromaticoCualInput = document.getElementById('fotocromatico-cual-input');
            
            if (this.value === 'SI') {
                fotocromaticoCualInput.style.display = 'inline-block';
                fotocromaticoCualInput.required = true;  // Hacer obligatorio el campo si selecciona "Sí"
            } else {
                fotocromaticoCualInput.style.display = 'none';
                fotocromaticoCualInput.required = false;  // Quitar la obligatoriedad si no es "Sí"
                fotocromaticoCualInput.value = '';  // Limpiar el campo si se oculta
            }
        });
    </script>
    <script>
        document.getElementById('monofocal-select').addEventListener('change', function() {
            const monofocalOptions = document.getElementById('monofocal-options');
            
            if (this.value === 'SI') {
                monofocalOptions.style.display = 'inline-block';
                monofocalOptions.required = true;  // Hacer obligatorio si se elige "Sí"
            } else {
                monofocalOptions.style.display = 'none';
                monofocalOptions.required = false;  // Quitar la obligatoriedad si no es "Sí"
                monofocalOptions.value = '';  // Limpiar el campo si se oculta
            }
        });
    </script>
    <script>
        document.getElementById('progresivo-select').addEventListener('change', function() {
            const progresivoGama = document.getElementById('progresivo-gama');
            
            if (this.value === 'SI') {
                progresivoGama.style.display = 'inline-block';
                progresivoGama.required = true;  // Hacer obligatorio si se elige "Sí"
            } else {
                progresivoGama.style.display = 'none';
                progresivoGama.required = false;  // Quitar la obligatoriedad si no es "Sí"
                progresivoGama.value = '';  // Limpiar el campo si se oculta
            }
        });
    </script>
    <script>
        function validarPagos() {
            // Obtener el valor de "Total Venta"
            const totalVenta = parseFloat(document.getElementById('total_venta').value) || 0;

            // Obtener los valores de las formas de pago desde los campos ocultos
            const pagoEfectivo = parseFloat(document.getElementById('pago_efectivo').value) || 0;
            const pagoSistecredito = parseFloat(document.getElementById('pago_sistecredito').value) || 0;
            const pagoBancolombia = parseFloat(document.getElementById('pago_bancolombia').value) || 0;
            const pagoDavivienda = parseFloat(document.getElementById('pago_davivienda').value) || 0;
            const pagoAddi = parseFloat(document.getElementById('pago_addi').value) || 0;
            const pagoEnvia = parseFloat(document.getElementById('pago_envia').value) || 0;
            const pagoInterapidismo = parseFloat(document.getElementById('pago_interapidismo').value) || 0;
            const pagoPasaPagos = parseFloat(document.getElementById('pasa_pagos').value) || 0;
            const pagoBold = parseFloat(document.getElementById('pago_bold').value) || 0;
            const pagoMensajeriaEklat = parseFloat(document.getElementById('pago_mensajeria_eklat').value) || 0;
            const pagoMercadopago = parseFloat(document.getElementById('pago_mercadopago').value) || 0;
            const pagoServientrega = parseFloat(document.getElementById('pago_servientrega').value) || 0;
            const pagoOtro = parseFloat(document.getElementById('pago_otro').value) || 0;

            // Calcular la suma de las formas de pago
            const sumaPagos = pagoEfectivo + pagoSistecredito + pagoBancolombia + pagoDavivienda +
                            pagoAddi + pagoEnvia + pagoInterapidismo + pagoPasaPagos + pagoBold +
                            pagoMensajeriaEklat + pagoMercadopago + pagoServientrega + pagoOtro;

            // Comparar la suma con el "Total Venta"
            if (sumaPagos !== totalVenta) {
                alert('La suma de las formas de pago debe ser igual al Total Venta.');
                console.log(`Total Venta: ${totalVenta}, Suma Pagos: ${sumaPagos}`); // Depuración
                return false; // Evitar el envío del formulario si la validación falla
            }

            // Si la validación pasa, permitir que el formulario se envíe
            return true;
        }
    </script>

    <script>
        // Copiar el valor del campo "vendedor" al campo "ordenado_a"
        document.querySelector('input[name="vendedor"]').addEventListener('input', function() {
            document.querySelector('input[name="ordenado_por"]').value = this.value;
        });
    
        // Copiar el valor del campo "nombre_cliente" al campo "ordenado_por"
        document.querySelector('input[name="nombre_cliente"]').addEventListener('input', function() {
            document.querySelector('input[name="ordenado_a"]').value = this.value;
        });
    </script>
    <script>
        function formatCurrency(input, hiddenFieldId) {
            let value = input.value.replace(/[^0-9]/g, '');
            if (value) {
                document.getElementById(hiddenFieldId).value = value; // Actualiza el campo oculto
                value = parseInt(value, 10).toLocaleString('es-CO', { style: 'currency', currency: 'COP', minimumFractionDigits: 0 });
            }
            input.value = value;
            calculateTotal(); // Llamar a calculateTotal después de formatear
        }
    </script>


    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>



    <script>
        // Inicialización de Flatpickr en los campos de fecha
        flatpickr("#fecha", {
            dateFormat: "d/m/Y",
            locale: "es",
            onChange: function(selectedDates, dateStr, instance) {
                // Copiar la fecha seleccionada en "fecha" a "fecha_lab"
                document.querySelector("#fecha_lab")._flatpickr.setDate(dateStr);
            }
        });
        
        flatpickr("#fecha_entrega", {
            dateFormat: "d/m/Y",
            locale: "es"
        });

        flatpickr("#fecha_lab", {
            dateFormat: "d/m/Y",
            locale: "es"
        });
    </script>

<script>
    // Datos de departamentos y ciudades en Colombia
    const departamentosYciudades = {
    "Amazonas": ["Leticia", "Puerto Nariño", "El Encanto", "La Chorrera", "La Pedrera", "La Victoria", "Mirití-Paraná", "Puerto Alegría", "Puerto Arica", "Tarapacá"],
    "Antioquia": ["Abejorral", "Abriaquí", "Alejandría", "Amagá", "Amalfi", "Andes", "Angelópolis", "Angostura", "Anorí", "Santafé de Antioquia", "Anza", "Apartadó", "Arboletes", "Argelia", "Armenia", "Barbosa", "Bello", "Belmira", "Betania", "Betulia", "Briceño", "Buriticá", "Cáceres", "Caicedo", "Caldas", "Campamento", "Cañasgordas", "Caracolí", "Caramanta", "Carepa", "Carolina", "Caucasia", "Chigorodó", "Cisneros", "Cocorná", "Concepción", "Concordia", "Copacabana", "Dabeiba", "Donmatías", "Ebéjico", "El Bagre", "Entrerríos", "Envigado", "Fredonia", "Frontino", "Giraldo", "Girardota", "Gómez Plata", "Granada", "Guadalupe", "Guarne", "Guatapé", "Heliconia", "Hispania", "Itagüí", "Ituango", "Jardín", "Jericó", "La Ceja", "La Estrella", "La Pintada", "La Unión", "Liborina", "Maceo", "Marinilla", "Medellín", "Montebello", "Murindó", "Mutatá", "Nariño", "Nechí", "Necoclí", "Olaya", "Peque", "Pueblorrico", "Puerto Berrío", "Puerto Nare", "Puerto Triunfo", "Remedios", "Retiro", "Rionegro", "Sabanalarga", "Sabaneta", "Salgar", "San Andrés de Cuerquia", "San Carlos", "San Francisco", "San Jerónimo", "San José de la Montaña", "San Juan de Urabá", "San Luis", "San Pedro de los Milagros", "San Pedro de Urabá", "San Rafael", "San Roque", "San Vicente", "Santa Bárbara", "Santa Rosa de Osos", "Santo Domingo", "Segovia", "Sonsón", "Sopetrán", "Támesis", "Tarazá", "Tarso", "Titiribí", "Toledo", "Turbo", "Uramita", "Urrao", "Valdivia", "Valparaíso", "Vegachí", "Venecia", "Vigía del Fuerte", "Yalí", "Yarumal", "Yolombó", "Yondó", "Zaragoza"],
    "Arauca": ["Arauca", "Arauquita", "Cravo Norte", "Fortul", "Puerto Rondón", "Saravena", "Tame"],
    "Atlántico": ["Barranquilla", "Baranoa", "Campo de la Cruz", "Candelaria", "Galapa", "Juan de Acosta", "Luruaco", "Malambo", "Manatí", "Palmar de Varela", "Piojó", "Polonuevo", "Ponedera", "Puerto Colombia", "Repelón", "Sabanagrande", "Sabanalarga", "Santa Lucía", "Santo Tomás", "Soledad", "Suan", "Tubará", "Usiacurí"],
    "Bogotá D.C": ["Bogotá D.C."],
    "Bolívar": ["Cartagena de Indias", "Achí", "Altos del Rosario", "Arenal", "Arjona", "Arroyohondo", "Barranco de Loba", "Calamar", "Cantagallo", "Cicuco", "Clemencia", "Córdoba", "El Carmen de Bolívar", "El Guamo", "El Peñón", "Hatillo de Loba", "Magangué", "Mahates", "Margarita", "María la Baja", "Montecristo", "Morales", "Norosí", "Pinillos", "Regidor", "Río Viejo", "San Cristóbal", "San Estanislao", "San Fernando", "San Jacinto", "San Jacinto del Cauca", "San Juan Nepomuceno", "San Martín de Loba", "Santa Catalina", "Santa Rosa", "Santa Rosa del Sur", "Simití", "Soplaviento", "Talaigua Nuevo", "Tiquisio", "Turbaco", "Turbaná", "Villanueva", "Zambrano"],
    "Boyacá": ["Tunja", "Almeida", "Aquitania", "Arcabuco", "Belén", "Berbeo", "Betéitiva", "Boavita", "Boyacá", "Briceño", "Buena Vista", "Busbanzá", "Caldas", "Campohermoso", "Cerinza", "Chinavita", "Chiquinquirá", "Chíquiza", "Chiscas", "Chita", "Chitaraque", "Chivatá", "Ciénaga", "Cómbita", "Coper", "Corrales", "Covarachía", "Cubará", "Cucaita", "Cuítiva", "Chivor", "Duitama", "El Cocuy", "El Espino", "Firavitoba", "Floresta", "Gachantivá", "Gámeza", "Garagoa", "Guacamayas", "Guateque", "Guayatá", "Güicán", "Iza", "Jenesano", "Jericó", "Labranzagrande", "La Capilla", "La Uvita", "La Victoria", "Macanal", "Maripí", "Miraflores", "Mongua", "Monguí", "Moniquirá", "Motavita", "Muzo", "Nobsa", "Nuevo Colón", "Oicatá", "Otanche", "Pachavita", "Páez", "Paipa", "Pajarito", "Panqueba", "Pauna", "Paya", "Paz de Río", "Pesca", "Pisba", "Puerto Boyacá", "Quípama", "Ramiriquí", "Ráquira", "Rondón", "Saboyá", "Sáchica", "Samacá", "San Eduardo", "San José de Pare", "San Luis de Gaceno", "San Mateo", "San Miguel de Sema", "San Pablo de Borbur", "Santa María", "Santa Rosa de Viterbo", "Santa Sofía", "Santana", "Sativanorte", "Sativasur", "Siachoque", "Soatá", "Socha", "Socotá", "Sogamoso", "Somondoco", "Sora", "Sotaquirá", "Soracá", "Susacón", "Sutamarchán", "Sutatenza", "Tasco", "Tenza", "Tibaná", "Tibasosa", "Tinjacá", "Tipacoque", "Toca", "Togüí", "Tópaga", "Tota", "Tununguá", "Turmequé", "Tuta", "Tutazá", "Úmbita", "Ventaquemada", "Viracachá", "Villa de Leyva", "Zetaquira"],
    "Caldas": ["Manizales", "Aguadas", "Anserma", "Aranzazu", "Belalcázar", "Chinchiná", "Filadelfia", "La Dorada", "La Merced", "Manzanares", "Marmato", "Marquetalia", "Marulanda", "Neira", "Norcasia", "Pácora", "Palestina", "Pensilvania", "Riosucio", "Risaralda", "Salamina", "Samaná", "San José", "Supía", "Victoria", "Villamaría", "Viterbo"],
    "Caquetá": ["Florencia", "Albania", "Belén de los Andaquíes", "Cartagena del Chairá", "Curillo", "El Doncello", "El Paujil", "La Montañita", "Milán", "Morelia", "Puerto Rico", "San José del Fragua", "San Vicente del Caguán", "Solano", "Solita", "Valparaíso"],
    "Casanare": ["Yopal", "Aguazul", "Chámeza", "Hato Corozal", "La Salina", "Maní", "Monterrey", "Nunchía", "Orocué", "Paz de Ariporo", "Pore", "Recetor", "Sabanalarga", "Sácama", "San Luis de Palenque", "Támara", "Tauramena", "Trinidad", "Villanueva"],
    "Cauca": ["Popayán", "Almaguer", "Argelia", "Balboa", "Bolívar", "Buenos Aires", "Cajibío", "Caldono", "Caloto", "Corinto", "El Tambo", "Florencia", "Guachené", "Guapí", "Inzá", "Jambaló", "La Sierra", "La Vega", "López de Micay", "Mercaderes", "Miranda", "Morales", "Padilla", "Páez", "Patía", "Piamonte", "Piendamó", "Puerto Tejada", "Puracé", "Rosas", "San Sebastián", "Santa Rosa", "Santander de Quilichao", "Silvia", "Sotará", "Suárez", "Sucre", "Timbío", "Timbiquí", "Toribío", "Totoró", "Villa Rica"],
    "Cesar": ["Valledupar", "Aguachica", "Agustín Codazzi", "Astrea", "Becerril", "Bosconia", "Chimichagua", "Chiriguaná", "Curumaní", "El Copey", "El Paso", "Gamarra", "González", "La Gloria", "La Jagua de Ibirico", "La Paz", "Manaure Balcón del Cesar", "Pailitas", "Pelaya", "Pueblo Bello", "Río de Oro", "San Alberto", "San Diego", "San Martín", "Tamalameque"],
    "Chocó": ["Quibdó", "Acandí", "Alto Baudó", "Atrato", "Bagadó", "Bahía Solano", "Bajo Baudó", "Bojayá", "Cantón de San Pablo", "Cértegui", "Condoto", "El Carmen de Atrato", "El Carmen del Darién", "Istmina", "Juradó", "Litoral del San Juan", "Lloró", "Medio Atrato", "Medio Baudó", "Medio San Juan", "Nóvita", "Nuquí", "Río Iró", "Río Quito", "Riosucio", "San José del Palmar", "Sipí", "Tadó", "Unguía", "Unión Panamericana"],
    "Córdoba": ["Montería", "Ayapel", "Buenavista", "Canalete", "Cereté", "Chimá", "Chinú", "Ciénaga de Oro", "Cotorra", "La Apartada", "Lorica", "Los Córdobas", "Momil", "Montelíbano", "Moñitos", "Planeta Rica", "Pueblo Nuevo", "Puerto Escondido", "Puerto Libertador", "Purísima", "Sahagún", "San Andrés de Sotavento", "San Antero", "San Bernardo del Viento", "San Carlos", "San José de Uré", "San Pelayo", "Tierralta", "Tuchín", "Valencia"],
    "Cundinamarca": ["Agua de Dios", "Albán", "Anapoima", "Anolaima", "Apulo", "Arbeláez", "Beltrán", "Bituima", "Bojacá", "Cabrera", "Cachipay", "Cajicá", "Caparrapí", "Cáqueza", "Carmen de Carupa", "Chaguaní", "Chía", "Chipaque", "Choachí", "Chocontá", "Cogua", "Cota", "Cucunubá", "El Colegio", "El Peñón", "El Rosal", "Facatativá", "Fómeque", "Fosca", "Funza", "Fúquene", "Fusagasugá", "Gachalá", "Gachancipá", "Gachetá", "Gama", "Girardot", "Granada", "Guachetá", "Guaduas", "Guasca", "Guataquí", "Guatavita", "Guayabal de Síquima", "Guayabetal", "Gutiérrez", "Jerusalén", "Junín", "La Calera", "La Mesa", "La Palma", "La Peña", "La Vega", "Lenguazaque", "Machetá", "Madrid", "Manta", "Medina", "Mosquera", "Nariño", "Nemocón", "Nilo", "Nimaima", "Nocaima", "Pacho", "Paime", "Pandi", "Paratebueno", "Pasca", "Puerto Salgar", "Pulí", "Quebradanegra", "Quetame", "Quipile", "Ricaurte", "San Antonio del Tequendama", "San Bernardo", "San Cayetano", "San Francisco", "San Juan de Río Seco", "Sasaima", "Sesquilé", "Sibaté", "Silvania", "Simijaca", "Soacha", "Sopó", "Subachoque", "Suesca", "Supatá", "Susa", "Sutatausa", "Tabio", "Tausa", "Tena", "Tenjo", "Tibacuy", "Tibirita", "Tocaima", "Tocancipá", "Topaipí", "Ubalá", "Ubaque", "Ubaté", "Une", "Útica", "Venecia", "Vergara", "Vianí", "Villagómez", "Villapinzón", "Villeta", "Viotá", "Yacopí", "Zipacón", "Zipaquirá"],
    "Guainía": ["Inírida", "Barrancominas"],
    "Guaviare": ["San José del Guaviare", "Calamar", "El Retorno", "Miraflores"],
    "Huila": ["Neiva", "Acevedo", "Agrado", "Aipe", "Algeciras", "Altamira", "Baraya", "Campoalegre", "Colombia", "Elías", "Garzón", "Gigante", "Guadalupe", "Hobo", "Iquira", "Isnos", "La Argentina", "La Plata", "Nátaga", "Oporapa", "Paicol", "Palermo", "Palestina", "Pital", "Pitalito", "Rivera", "Saladoblanco", "San Agustín", "Santa María", "Suaza", "Tarqui", "Tello", "Teruel", "Tesalia", "Timaná", "Villavieja", "Yaguará"],
    "La Guajira": ["Riohacha", "Albania", "Barrancas", "Dibulla", "Distracción", "El Molino", "Fonseca", "Hatonuevo", "La Jagua del Pilar", "Maicao", "Manaure", "San Juan del Cesar", "Uribia", "Urumita", "Villanueva"],
    "Magdalena": ["Santa Marta", "Algarrobo", "Aracataca", "Ariguaní", "Cerro de San Antonio", "Chibolo", "Ciénaga", "Concordia", "El Banco", "El Piñón", "El Retén", "Fundación", "Guamal", "Nueva Granada", "Pedraza", "Pijiño del Carmen", "Pivijay", "Plato", "Puebloviejo", "Remolino", "Sabanas de San Ángel", "Salamina", "San Sebastián de Buenavista", "San Zenón", "Santa Ana", "Santa Bárbara de Pinto", "Sitionuevo", "Tenerife", "Zapayán", "Zona Bananera"],
    "Meta": ["Villavicencio", "Acacías", "Barranca de Upía", "Cabuyaro", "Castilla La Nueva", "Cubarral", "Cumaral", "El Calvario", "El Castillo", "El Dorado", "Fuente de Oro", "Granada", "Guamal", "Mapiripán", "Mesetas", "La Macarena", "La Uribe", "Lejanías", "Puerto Concordia", "Puerto Gaitán", "Puerto Lleras", "Puerto López", "Puerto Rico", "Restrepo", "San Carlos de Guaroa", "San Juan de Arama", "San Juanito", "San Martín", "Vista Hermosa"],
    "Nariño": ["Pasto", "Albán", "Aldana", "Ancuyá", "Arboleda", "Barbacoas", "Belén", "Buesaco", "Chachagüí", "Colón", "Consacá", "Contadero", "Córdoba", "Cuaspud", "Cumbal", "Cumbitara", "El Charco", "El Peñol", "El Rosario", "El Tablón de Gómez", "El Tambo", "Francisco Pizarro", "Funes", "Guachucal", "Guaitarilla", "Gualmatán", "Iles", "Imués", "Ipiales", "La Cruz", "La Florida", "La Llanada", "La Tola", "La Unión", "Leiva", "Linares", "Los Andes", "Magüí", "Mallama", "Mosquera", "Nariño", "Olaya Herrera", "Ospina", "Policarpa", "Potosí", "Providencia", "Puerres", "Pupiales", "Ricaurte", "Roberto Payán", "Samaniego", "San Bernardo", "San Lorenzo", "San Pablo", "San Pedro de Cartago", "Sandoná", "Santa Bárbara", "Santacruz", "Sapuyes", "Taminango", "Tangua", "Tumaco", "Túquerres", "Yacuanquer"],
    "Norte de Santander": ["Cúcuta", "Abrego", "Arboledas", "Bochalema", "Bucarasica", "Cácota", "Cáchira", "Chinácota", "Chitagá", "Convención", "Cucutilla", "Durania", "El Carmen", "El Tarra", "El Zulia", "Gramalote", "Hacarí", "Herrán", "La Esperanza", "La Playa", "Labateca", "Los Patios", "Lourdes", "Mutiscua", "Ocaña", "Pamplona", "Pamplonita", "Puerto Santander", "Ragonvalia", "Salazar", "San Calixto", "San Cayetano", "Santiago", "Sardinata", "Silos", "Teorama", "Tibú", "Toledo", "Villa Caro", "Villa del Rosario"],
    "Putumayo": ["Mocoa", "Colón", "Orito", "Puerto Asís", "Puerto Caicedo", "Puerto Guzmán", "Leguízamo", "San Francisco", "San Miguel", "Santiago", "Sibundoy", "Valle del Guamuez", "Villagarzón"],
    "Quindío": ["Armenia", "Buenavista", "Calarcá", "Circasia", "Córdoba", "Filandia", "Génova", "La Tebaida", "Montenegro", "Pijao", "Quimbaya", "Salento"],
    "Risaralda": ["Pereira", "Apía", "Balboa", "Belén de Umbría", "Dosquebradas", "Guática", "La Celia", "La Virginia", "Marsella", "Mistrató", "Pueblo Rico", "Quinchía", "Santa Rosa de Cabal", "Santuario"],
    "San Andrés y Providencia": ["San Andrés", "Providencia"],
    "Santander": ["Bucaramanga", "Aguada", "Albania", "Aratoca", "Barbosa", "Barichara", "Barrancabermeja", "Betulia", "Bolívar", "Cabrera", "California", "Capitanejo", "Carcasí", "Cepitá", "Cerrito", "Charalá", "Charta", "Chima", "Chipatá", "Cimitarra", "Concepción", "Confines", "Contratación", "Coromoro", "Curití", "El Carmen de Chucurí", "El Guacamayo", "El Peñón", "El Playón", "Encino", "Enciso", "Florián", "Floridablanca", "Galán", "Gámbita", "Girón", "Guaca", "Guadalupe", "Guapotá", "Guavatá", "Güepsa", "Hato", "Jesús María", "Jordán", "La Belleza", "La Paz", "Landázuri", "Lebrija", "Los Santos", "Macaravita", "Málaga", "Matanza", "Mogotes", "Molagavita", "Ocamonte", "Oiba", "Onzaga", "Palmar", "Palmas del Socorro", "Páramo", "Piedecuesta", "Pinchote", "Puente Nacional", "Puerto Parra", "Puerto Wilches", "Rionegro", "Sabana de Torres", "San Andrés", "San Benito", "San Gil", "San Joaquín", "San José de Miranda", "San Miguel", "San Vicente de Chucurí", "Santa Bárbara", "Santa Helena del Opón", "Simacota", "Socorro", "Suaita", "Sucre", "Suratá", "Tona", "Valle de San José", "Vetas", "Villanueva", "Zapatoca"],
    "Sucre": ["Sincelejo", "Buenavista", "Caimito", "Chalán", "Colosó", "Corozal", "Coveñas", "El Roble", "Galeras", "Guaranda", "La Unión", "Los Palmitos", "Majagual", "Morroa", "Ovejas", "Palmito", "Sampués", "San Benito Abad", "San Juan de Betulia", "San Marcos", "San Onofre", "San Pedro", "Sincé", "Sucre", "Tolú", "Tolú Viejo"],
    "Tolima": ["Ibagué", "Alpujarra", "Alvarado", "Ambalema", "Anzoátegui", "Ataco", "Cajamarca", "Carmen de Apicalá", "Casabianca", "Chaparral", "Coello", "Coyaima", "Cunday", "Dolores", "Espinal", "Falan", "Flandes", "Fresno", "Guamo", "Herveo", "Honda", "Icononzo", "Lérida", "Líbano", "Mariquita", "Melgar", "Murillo", "Natagaima", "Ortega", "Palocabildo", "Piedras", "Planadas", "Prado", "Purificación", "Rio Blanco", "Roncesvalles", "Rovira", "Saldaña", "San Antonio", "San Luis", "Santa Isabel", "Suárez", "Valle de San Juan", "Venadillo", "Villahermosa", "Villarrica"],
    "Valle del Cauca": ["Cali", "Alcalá", "Andalucía", "Ansermanuevo", "Argelia", "Bolívar", "Buenaventura", "Buga", "Bugalagrande", "Caicedonia", "Calima", "Candelaria", "Cartago", "Dagua", "El Águila", "El Cairo", "El Cerrito", "El Dovio", "Florida", "Ginebra", "Guacarí", "Jamundí", "La Cumbre", "La Unión", "La Victoria", "Obando", "Palmira", "Pradera", "Restrepo", "Riofrío", "Roldanillo", "San Pedro", "Sevilla", "Toro", "Trujillo", "Tuluá", "Ulloa", "Versalles", "Vijes", "Yotoco", "Yumbo", "Zarzal"],
    "Vaupés": ["Mitú", "Carurú", "Pacoa", "Taraira", "Yavaraté"],
    "Vichada": ["Puerto Carreño", "Cumaribo", "La Primavera", "Santa Rosalía"]
    };


    // Inicializar los selectores
    document.addEventListener('DOMContentLoaded', function() {
        const departamentoSelect = document.getElementById('departamento');
        const ciudadSelect = document.getElementById('ciudad');

        // Rellenar el select de departamentos
        for (const departamento in departamentosYciudades) {
            const option = document.createElement('option');
            option.value = departamento;
            option.textContent = departamento;
            departamentoSelect.appendChild(option);
        }

        // Cuando se selecciona un departamento, actualizar el select de ciudades
        departamentoSelect.addEventListener('change', function() {
            const ciudades = departamentosYciudades[this.value];
            ciudadSelect.innerHTML = '<option value="">Selecciona una Ciudad</option>'; // Resetear el select de ciudades

            if (ciudades) {
                ciudades.forEach(ciudad => {
                    const option = document.createElement('option');
                    option.value = ciudad;
                    option.textContent = ciudad;
                    ciudadSelect.appendChild(option);
                });
            }
        });
    });
    </script>
    
</body>
</html>
